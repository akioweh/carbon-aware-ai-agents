openapi: 3.0.3
info:
  title: Stats API (Stats Component)
  description: |
    API for environmental and operational data to support carbon-aware scheduling.
    
    The Stats component integrates data from multiple external sources:
    - **Grid Carbon Intensity**: Real-time and forecasted carbon emissions per kWh
    - **Data Center State**: Current load, capacity, and hardware availability
    - **Weather Data**: Temperature and humidity affecting cooling efficiency
    - **Cost Context**: Compute costs per location
    
    Historical data endpoints track load and "greenness" (inverse of carbon intensity)
    at 5-minute intervals for pattern analysis and forecasting.
  version: 1.0.0
  contact:
    name: API Support

servers:
  - url: http://localhost:5000
    description: Local development server

tags:
  - name: History
    description: Historical data endpoints (load and greenness tracking)
  - name: Latest
    description: Latest data endpoints
  - name: Context
    description: Scheduling context endpoints (carbon, capacity, weather, costs)

paths:
  /history:
    get:
      tags:
        - History
      summary: Get full history
      description: Returns the complete history of all data points including timestamp, load, and greenness
      operationId: getFullHistory
      responses:
        '200':
          description: Successful response with full history
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/FullDataPoint'
              example:
                - timestamp: "2025-11-05T18:20:39.679404"
                  load: 8.168924463462984
                  greenness: 48.67735982423504
                - timestamp: "2025-11-05T18:25:39.679404"
                  load: 9.132001328854178
                  greenness: 43.65320150893125

  /load/history:
    get:
      tags:
        - History
      summary: Get load history
      description: Returns historical data containing only timestamp and load values
      operationId: getLoadHistory
      responses:
        '200':
          description: Successful response with load history
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/LoadDataPoint'
              example:
                - timestamp: "2025-11-05T18:20:39.679404"
                  load: 8.168924463462984
                - timestamp: "2025-11-05T18:25:39.679404"
                  load: 9.132001328854178

  /greenness/history:
    get:
      tags:
        - History
      summary: Get greenness history
      description: Returns historical data containing only timestamp and greenness values
      operationId: getGreennessHistory
      responses:
        '200':
          description: Successful response with greenness history
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/GreennessDataPoint'
              example:
                - timestamp: "2025-11-05T18:20:39.679404"
                  greenness: 48.67735982423504
                - timestamp: "2025-11-05T18:25:39.679404"
                  greenness: 43.65320150893125

  /latest:
    get:
      tags:
        - Latest
      summary: Get latest data
      description: Returns the most recent data point with timestamp, load, and greenness
      operationId: getLatest
      responses:
        '200':
          description: Successful response with latest data point
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FullDataPoint'
              example:
                timestamp: "2025-12-05T18:20:39.679404"
                load: 25.5
                greenness: 75.3

  /load/latest:
    get:
      tags:
        - Latest
      summary: Get latest load
      description: Returns the most recent load data point with timestamp and load value
      operationId: getLatestLoad
      responses:
        '200':
          description: Successful response with latest load data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoadDataPoint'
              example:
                timestamp: "2025-12-05T18:20:39.679404"
                load: 25.5

  /greenness/latest:
    get:
      tags:
        - Latest
      summary: Get latest greenness
      description: Returns the most recent greenness data point with timestamp and greenness value
      operationId: getLatestGreenness
      responses:
        '200':
          description: Successful response with latest greenness data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GreennessDataPoint'
              example:
                timestamp: "2025-12-05T18:20:39.679404"
                greenness: 75.3

  /carbon/forecast:
    get:
      tags:
        - Context
      summary: Get carbon intensity forecast
      description: Returns grid carbon intensity forecast for scheduling optimization
      parameters:
        - name: location
          in: query
          description: Location ID (optional, default is all locations)
          schema:
            type: string
          example: "dc1"
        - name: hours
          in: query
          description: Number of hours to forecast (default 24)
          schema:
            type: integer
            default: 24
          example: 48
      responses:
        '200':
          description: Carbon intensity forecast
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CarbonForecast'
              example:
                location: "dc1"
                forecast:
                  - timestamp: "2025-12-08T00:00:00Z"
                    intensity: 0.25
                  - timestamp: "2025-12-08T01:00:00Z"
                    intensity: 0.22
                  - timestamp: "2025-12-08T02:00:00Z"
                    intensity: 0.15

  /datacenter/capacity:
    get:
      tags:
        - Context
      summary: Get data center capacity and load
      description: Returns current load and available capacity for data centers
      parameters:
        - name: location
          in: query
          description: Location ID (optional, default is all locations)
          schema:
            type: string
          example: "dc1"
      responses:
        '200':
          description: Data center capacity info
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DataCenterStatus'
              example:
                - location_id: "dc1"
                  current_load: 25.5
                  max_capacity: 50.0
                  available_gpus: 16
                  total_gpus: 32
                - location_id: "dc2"
                  current_load: 35.0
                  max_capacity: 50.0
                  available_gpus: 8
                  total_gpus: 24

  /weather/current:
    get:
      tags:
        - Context
      summary: Get current weather data
      description: Returns weather data that may affect data center cooling and efficiency
      parameters:
        - name: location
          in: query
          description: Location ID
          required: true
          schema:
            type: string
          example: "dc1"
      responses:
        '200':
          description: Current weather data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WeatherData'
              example:
                location: "dc1"
                temperature_celsius: 22
                humidity_percent: 65

  /costs/compute:
    get:
      tags:
        - Context
      summary: Get compute costs
      description: Returns cost per compute unit for different locations
      responses:
        '200':
          description: Compute costs
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ComputeCosts'
              example:
                - location_id: "dc1"
                  cost_per_gpu_hour: 2.50
                  currency: "USD"
                - location_id: "dc2"
                  cost_per_gpu_hour: 3.00
                  currency: "USD"

components:
  schemas:
    FullDataPoint:
      type: object
      description: Complete data point with timestamp, load, and greenness
      required:
        - timestamp
        - load
        - greenness
      properties:
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 formatted timestamp
          example: "2025-12-05T18:20:39.679404"
        load:
          type: number
          format: float
          description: Data center load value (0-50, where 50 is max capacity)
          minimum: 0
          maximum: 50
          example: 25.5
        greenness:
          type: number
          format: float
          description: Energy greenness score (0-100, higher is greener)
          minimum: 0
          maximum: 100
          example: 75.3
    
    LoadDataPoint:
      type: object
      description: Data point containing timestamp and load
      required:
        - timestamp
        - load
      properties:
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 formatted timestamp
          example: "2025-12-05T18:20:39.679404"
        load:
          type: number
          format: float
          description: Data center load value (0-50, where 50 is max capacity)
          minimum: 0
          maximum: 50
          example: 25.5
    
    GreennessDataPoint:
      type: object
      description: Data point containing timestamp and greenness
      required:
        - timestamp
        - greenness
      properties:
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 formatted timestamp
          example: "2025-12-05T18:20:39.679404"
        greenness:
          type: number
          format: float
          description: Energy greenness score (0-100, higher is greener)
          minimum: 0
          maximum: 100
          example: 75.3
    
    CarbonForecast:
      type: object
      description: Carbon intensity forecast for a location
      required:
        - location
        - forecast
      properties:
        location:
          type: string
          description: Location identifier
          example: "dc1"
        forecast:
          type: array
          description: Hourly carbon intensity forecast
          items:
            $ref: '#/components/schemas/CarbonPoint'
    
    CarbonPoint:
      type: object
      description: Carbon intensity at a point in time
      required:
        - timestamp
        - intensity
      properties:
        timestamp:
          type: string
          format: date-time
          description: Forecast timestamp
          example: "2025-12-08T00:00:00Z"
        intensity:
          type: number
          description: Carbon intensity (kg CO2/kWh)
          example: 0.25
    
    DataCenterStatus:
      type: object
      description: Data center capacity and load status
      required:
        - location_id
        - current_load
        - max_capacity
      properties:
        location_id:
          type: string
          description: Location identifier
          example: "dc1"
        current_load:
          type: number
          description: Current load (0-50 scale)
          example: 25.5
        max_capacity:
          type: number
          description: Maximum capacity
          example: 50.0
        available_gpus:
          type: integer
          description: Number of available GPUs
          example: 16
        total_gpus:
          type: integer
          description: Total number of GPUs
          example: 32
    
    WeatherData:
      type: object
      description: Weather data affecting data center efficiency
      required:
        - location
        - temperature_celsius
      properties:
        location:
          type: string
          description: Location identifier
          example: "dc1"
        temperature_celsius:
          type: number
          description: Outside temperature in Celsius
          example: 22
        humidity_percent:
          type: number
          description: Relative humidity percentage
          minimum: 0
          maximum: 100
          example: 65
    
    ComputeCosts:
      type: object
      description: Compute costs for a location
      required:
        - location_id
        - cost_per_gpu_hour
        - currency
      properties:
        location_id:
          type: string
          description: Location identifier
          example: "dc1"
        cost_per_gpu_hour:
          type: number
          description: Cost per GPU hour
          example: 2.50
        currency:
          type: string
          description: Currency code
          example: "USD"
