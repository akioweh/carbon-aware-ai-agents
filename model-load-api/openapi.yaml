openapi: 3.0.3
info:
  title: Model Load API
  description: |
    API for tracking and retrieving data center load and greenness metrics.
    
    This API provides historical and current data about:
    - **Load**: Data center load ranging from 0-50 arbitrary units (50 being capacity)
    - **Greenness**: Energy greenness score from 0-100 (higher values indicate greener energy)
    
    Data is collected at 5-minute intervals and is pattern-based to enable forecasting 
    and task scheduling.
  version: 1.0.0
  contact:
    name: API Support

servers:
  - url: http://localhost:5000
    description: Local development server

tags:
  - name: History
    description: Historical data endpoints
  - name: Latest
    description: Latest data endpoints
  - name: Context
    description: Scheduling context endpoints for Scheduler component

paths:
  /history:
    get:
      tags:
        - History
      summary: Get full history
      description: Returns the complete history of all data points including timestamp, load, and greenness
      operationId: getFullHistory
      responses:
        '200':
          description: Successful response with full history
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/FullDataPoint'
              example:
                - timestamp: "2025-11-05T18:20:39.679404"
                  load: 8.168924463462984
                  greenness: 48.67735982423504
                - timestamp: "2025-11-05T18:25:39.679404"
                  load: 9.132001328854178
                  greenness: 43.65320150893125

  /load/history:
    get:
      tags:
        - History
      summary: Get load history
      description: Returns historical data containing only timestamp and load values
      operationId: getLoadHistory
      responses:
        '200':
          description: Successful response with load history
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/LoadDataPoint'
              example:
                - timestamp: "2025-11-05T18:20:39.679404"
                  load: 8.168924463462984
                - timestamp: "2025-11-05T18:25:39.679404"
                  load: 9.132001328854178

  /greenness/history:
    get:
      tags:
        - History
      summary: Get greenness history
      description: Returns historical data containing only timestamp and greenness values
      operationId: getGreennessHistory
      responses:
        '200':
          description: Successful response with greenness history
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/GreennessDataPoint'
              example:
                - timestamp: "2025-11-05T18:20:39.679404"
                  greenness: 48.67735982423504
                - timestamp: "2025-11-05T18:25:39.679404"
                  greenness: 43.65320150893125

  /latest:
    get:
      tags:
        - Latest
      summary: Get latest data
      description: Returns the most recent data point with timestamp, load, and greenness
      operationId: getLatest
      responses:
        '200':
          description: Successful response with latest data point
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FullDataPoint'
              example:
                timestamp: "2025-12-05T18:20:39.679404"
                load: 25.5
                greenness: 75.3

  /load/latest:
    get:
      tags:
        - Latest
      summary: Get latest load
      description: Returns the most recent load data point with timestamp and load value
      operationId: getLatestLoad
      responses:
        '200':
          description: Successful response with latest load data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoadDataPoint'
              example:
                timestamp: "2025-12-05T18:20:39.679404"
                load: 25.5

  /greenness/latest:
    get:
      tags:
        - Latest
      summary: Get latest greenness
      description: Returns the most recent greenness data point with timestamp and greenness value
      operationId: getLatestGreenness
      responses:
        '200':
          description: Successful response with latest greenness data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GreennessDataPoint'
              example:
                timestamp: "2025-12-05T18:20:39.679404"
                greenness: 75.3

  /api/context:
    get:
      tags:
        - Context
      summary: Get scheduling context
      description: |
        Returns environmental and operational context data for the Scheduler component.
        This endpoint provides forecasted grid carbon intensity, data center load/capacity,
        costs, and other factors needed for optimal workload scheduling decisions.
        
        Query parameters allow filtering by time window and location to get relevant
        context for a specific scheduling decision.
      operationId: getSchedulingContext
      parameters:
        - name: start_time
          in: query
          description: Start of the time window (ISO 8601 format)
          required: false
          schema:
            type: string
            format: date-time
          example: "2025-12-08T00:00:00Z"
        - name: end_time
          in: query
          description: End of the time window (ISO 8601 format)
          required: false
          schema:
            type: string
            format: date-time
          example: "2025-12-10T23:59:59Z"
        - name: locations
          in: query
          description: Comma-separated list of locations to include (cloud regions or on-prem sites)
          required: false
          schema:
            type: string
          example: "aws-us-east-1,azure-eastus,on-prem-dc1"
      responses:
        '200':
          description: Successful response with scheduling context
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SchedulingContext'
              example:
                timestamp: "2025-12-07T22:47:00Z"
                time_window:
                  start: "2025-12-08T00:00:00Z"
                  end: "2025-12-10T23:59:59Z"
                locations:
                  - location_id: "on-prem-dc1"
                    location_type: "on-premise"
                    provider: null
                    region: null
                    current_load: 25.5
                    max_capacity: 50.0
                    available_capacity: 24.5
                    grid_carbon_intensity_forecast:
                      - timestamp: "2025-12-08T00:00:00Z"
                        intensity_kg_per_kwh: 0.25
                      - timestamp: "2025-12-08T03:00:00Z"
                        intensity_kg_per_kwh: 0.15
                      - timestamp: "2025-12-08T06:00:00Z"
                        intensity_kg_per_kwh: 0.18
                    facility_metrics:
                      pue: 1.2
                      wue: 1.8
                      renewable_percentage: 45
                    cost_context:
                      cost_per_gpu_hour: 3.50
                      cost_per_cpu_hour: 0.25
                      cost_per_gb_storage_month: 0.10
                      currency: "USD"
                    hardware_availability:
                      - gpu_type: "A100"
                        available_count: 16
                        total_count: 32
                      - gpu_type: "V100"
                        available_count: 8
                        total_count: 16
                  - location_id: "aws-us-east-1"
                    location_type: "cloud"
                    provider: "aws"
                    region: "us-east-1"
                    current_load: null
                    max_capacity: null
                    available_capacity: null
                    grid_carbon_intensity_forecast:
                      - timestamp: "2025-12-08T00:00:00Z"
                        intensity_kg_per_kwh: 0.35
                      - timestamp: "2025-12-08T03:00:00Z"
                        intensity_kg_per_kwh: 0.32
                      - timestamp: "2025-12-08T06:00:00Z"
                        intensity_kg_per_kwh: 0.28
                    facility_metrics:
                      pue: 1.1
                      wue: 1.5
                      renewable_percentage: 60
                    cost_context:
                      cost_per_gpu_hour: 4.20
                      cost_per_cpu_hour: 0.35
                      cost_per_gb_storage_month: 0.12
                      currency: "USD"
                    hardware_availability:
                      - gpu_type: "A100"
                        available_count: null
                        total_count: null
        '400':
          description: Invalid request parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContextError'
              example:
                error: "Invalid time window"
                message: "end_time must be after start_time"

components:
  schemas:
    FullDataPoint:
      type: object
      description: Complete data point with timestamp, load, and greenness
      required:
        - timestamp
        - load
        - greenness
      properties:
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 formatted timestamp
          example: "2025-12-05T18:20:39.679404"
        load:
          type: number
          format: float
          description: Data center load value (0-50, where 50 is max capacity)
          minimum: 0
          maximum: 50
          example: 25.5
        greenness:
          type: number
          format: float
          description: Energy greenness score (0-100, higher is greener)
          minimum: 0
          maximum: 100
          example: 75.3
    
    LoadDataPoint:
      type: object
      description: Data point containing timestamp and load
      required:
        - timestamp
        - load
      properties:
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 formatted timestamp
          example: "2025-12-05T18:20:39.679404"
        load:
          type: number
          format: float
          description: Data center load value (0-50, where 50 is max capacity)
          minimum: 0
          maximum: 50
          example: 25.5
    
    GreennessDataPoint:
      type: object
      description: Data point containing timestamp and greenness
      required:
        - timestamp
        - greenness
      properties:
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 formatted timestamp
          example: "2025-12-05T18:20:39.679404"
        greenness:
          type: number
          format: float
          description: Energy greenness score (0-100, higher is greener)
          minimum: 0
          maximum: 100
          example: 75.3
    
    SchedulingContext:
      type: object
      description: |
        Environmental and operational context for scheduling decisions.
        Provides forecasted data across multiple locations and time periods.
      required:
        - timestamp
        - locations
      properties:
        timestamp:
          type: string
          format: date-time
          description: When this context snapshot was generated
          example: "2025-12-07T22:47:00Z"
        time_window:
          $ref: '#/components/schemas/TimeWindow'
        locations:
          type: array
          description: List of location contexts
          items:
            $ref: '#/components/schemas/LocationContext'
    
    TimeWindow:
      type: object
      description: Time window for the context data
      properties:
        start:
          type: string
          format: date-time
          description: Start of time window
          example: "2025-12-08T00:00:00Z"
        end:
          type: string
          format: date-time
          description: End of time window
          example: "2025-12-10T23:59:59Z"
    
    LocationContext:
      type: object
      description: Context data for a specific location (cloud region or on-prem site)
      required:
        - location_id
        - location_type
        - grid_carbon_intensity_forecast
        - facility_metrics
        - cost_context
      properties:
        location_id:
          type: string
          description: Unique identifier for this location
          example: "on-prem-dc1"
        location_type:
          type: string
          description: Type of location
          enum: ["cloud", "on-premise", "edge"]
          example: "on-premise"
        provider:
          type: string
          description: Cloud provider name (if location_type is cloud)
          example: "aws"
          nullable: true
        region:
          type: string
          description: Cloud region (if location_type is cloud)
          example: "us-east-1"
          nullable: true
        current_load:
          type: number
          format: float
          description: Current load (0-50 for on-prem, null for cloud with elastic capacity)
          minimum: 0
          maximum: 50
          example: 25.5
          nullable: true
        max_capacity:
          type: number
          format: float
          description: Maximum capacity (50 for on-prem, null for cloud with elastic capacity)
          example: 50.0
          nullable: true
        available_capacity:
          type: number
          format: float
          description: Available capacity (max - current for on-prem, null for cloud)
          example: 24.5
          nullable: true
        grid_carbon_intensity_forecast:
          type: array
          description: Forecasted grid carbon intensity over time
          items:
            $ref: '#/components/schemas/CarbonIntensityForecast'
        facility_metrics:
          $ref: '#/components/schemas/FacilityMetrics'
        cost_context:
          $ref: '#/components/schemas/CostContext'
        hardware_availability:
          type: array
          description: Available hardware resources at this location
          items:
            $ref: '#/components/schemas/HardwareAvailability'
        policy_constraints:
          $ref: '#/components/schemas/LocationPolicyConstraints'
    
    CarbonIntensityForecast:
      type: object
      description: Carbon intensity forecast for a specific time
      required:
        - timestamp
        - intensity_kg_per_kwh
      properties:
        timestamp:
          type: string
          format: date-time
          description: Time point for this forecast
          example: "2025-12-08T00:00:00Z"
        intensity_kg_per_kwh:
          type: number
          format: float
          description: Grid carbon intensity in kg COâ‚‚e per kWh
          minimum: 0
          example: 0.25
        confidence:
          type: number
          format: float
          description: Forecast confidence (0-1)
          minimum: 0
          maximum: 1
          example: 0.85
    
    FacilityMetrics:
      type: object
      description: Data center facility efficiency metrics
      required:
        - pue
      properties:
        pue:
          type: number
          format: float
          description: Power Usage Effectiveness
          minimum: 1.0
          example: 1.2
        wue:
          type: number
          format: float
          description: Water Usage Effectiveness (liters per kWh)
          minimum: 0
          example: 1.8
        renewable_percentage:
          type: number
          format: float
          description: Percentage of renewable energy (0-100)
          minimum: 0
          maximum: 100
          example: 45
        cooling_type:
          type: string
          description: Type of cooling system
          example: "liquid"
          enum: ["air", "liquid", "hybrid", "free_cooling"]
    
    CostContext:
      type: object
      description: Cost information for this location
      required:
        - currency
      properties:
        cost_per_gpu_hour:
          type: number
          format: float
          description: Cost per GPU hour
          minimum: 0
          example: 3.50
        cost_per_cpu_hour:
          type: number
          format: float
          description: Cost per CPU hour
          minimum: 0
          example: 0.25
        cost_per_gb_memory_hour:
          type: number
          format: float
          description: Cost per GB memory hour
          minimum: 0
          example: 0.05
        cost_per_gb_storage_month:
          type: number
          format: float
          description: Cost per GB storage per month
          minimum: 0
          example: 0.10
        currency:
          type: string
          description: Currency code
          example: "USD"
    
    HardwareAvailability:
      type: object
      description: Available hardware resources of a specific type
      required:
        - gpu_type
      properties:
        gpu_type:
          type: string
          description: GPU model type
          example: "A100"
        available_count:
          type: integer
          description: Number of available GPUs (null for cloud with elastic capacity)
          minimum: 0
          example: 16
          nullable: true
        total_count:
          type: integer
          description: Total number of GPUs (null for cloud with elastic capacity)
          minimum: 0
          example: 32
          nullable: true
        memory_gb_per_unit:
          type: number
          format: float
          description: Memory per GPU in GB
          example: 80
    
    LocationPolicyConstraints:
      type: object
      description: Policy constraints specific to this location
      properties:
        compliance_certifications:
          type: array
          description: Compliance certifications for this location
          items:
            type: string
          example: ["soc2", "iso27001"]
        data_sovereignty:
          type: string
          description: Data sovereignty region
          example: "US"
        restricted_workloads:
          type: array
          description: Types of workloads not allowed at this location
          items:
            type: string
          example: []
    
    ContextError:
      type: object
      description: Error response for context endpoint
      required:
        - error
        - message
      properties:
        error:
          type: string
          description: Error category
          example: "Invalid time window"
        message:
          type: string
          description: Detailed error message
          example: "end_time must be after start_time"
